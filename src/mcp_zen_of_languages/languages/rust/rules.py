"""Rust zen principles as Pydantic models."""

from pydantic import HttpUrl

from mcp_zen_of_languages.rules.base_models import (
    LanguageZenPrinciples,
    PrincipleCategory,
    ZenPrinciple,
)

RUST_ZEN = LanguageZenPrinciples(
    language="rust",
    name="Rust",
    philosophy="Safety, Concurrency, and Zero-Cost Abstractions",
    source_text="Rust API Guidelines",
    source_url=HttpUrl("https://rust-lang.github.io/api-guidelines/"),
    principles=[
        ZenPrinciple(
            id="rust-001",
            principle="Avoid unwrap() and expect() in production code",
            category=PrincipleCategory.ERROR_HANDLING,
            severity=9,
            description="Use proper error handling with Result and Option",
            violations=[
                "unwrap() in library code",
                "expect() without clear justification",
                "Ignoring Result types",
                "Excessive panic usage",
            ],
            detectable_patterns=[".unwrap()", ".expect("],
            recommended_alternative="match, if let, ?, or unwrap_or",
        ),
        ZenPrinciple(
            id="rust-002",
            principle="Use the type system to prevent bugs",
            category=PrincipleCategory.TYPE_SAFETY,
            severity=8,
            description="Leverage Rust's type system for compile-time guarantees",
            violations=[
                "Using primitive types when newtype would be safer",
                "Stringly-typed APIs",
                "Not using enums for state machines",
                "Overuse of Option<T> instead of proper types",
            ],
            detectable_patterns=["String", "i32", "u32"],
        ),
        ZenPrinciple(
            id="rust-003",
            principle="Prefer iterators over loops",
            category=PrincipleCategory.IDIOMS,
            severity=7,
            description="Use iterator methods for functional, zero-cost abstractions",
            violations=[
                "Manual for loops over collections",
                "Index-based iteration",
                "Mutable accumulator patterns",
                "Not using map/filter/fold",
            ],
            detectable_patterns=["for i in 0..vec.len()", "manual mutation in loops"],
        ),
        ZenPrinciple(
            id="rust-004",
            principle="Clone sparingly",
            category=PrincipleCategory.PERFORMANCE,
            severity=7,
            description="Avoid unnecessary cloning, prefer borrowing",
            violations=[
                "Cloning when references work",
                "Excessive .clone() calls",
                "Not using Cow<T>",
                "Cloning in hot paths",
            ],
        ),
        ZenPrinciple(
            id="rust-005",
            principle="Use #[must_use] for important return types",
            category=PrincipleCategory.CORRECTNESS,
            severity=6,
            description="Mark Result and critical types as must_use",
            violations=[
                "Result types without must_use",
                "Ignoring function return values",
                "Not annotating important builders",
            ],
            detectable_patterns=["!#[must_use]"],
        ),
        ZenPrinciple(
            id="rust-006",
            principle="Implement Debug for all public types",
            category=PrincipleCategory.DEBUGGING,
            severity=6,
            description="Derive or implement Debug for better debugging",
            violations=[
                "Public structs without Debug",
                "Complex types without Debug",
                "Not using #[derive(Debug)]",
            ],
            detectable_patterns=["!#[derive(Debug)]"],
        ),
        ZenPrinciple(
            id="rust-007",
            principle="Use newtype pattern for type safety",
            category=PrincipleCategory.DESIGN,
            severity=7,
            description="Wrap primitives in newtypes for semantic clarity",
            violations=[
                "Using raw integers for IDs",
                "String for typed values",
                "Not distinguishing similar types (UserId vs ProductId)",
            ],
            detectable_patterns=["!struct "],
        ),
        ZenPrinciple(
            id="rust-008",
            principle="Avoid unsafe unless necessary",
            category=PrincipleCategory.SAFETY,
            severity=9,
            description="Minimize unsafe code and document invariants",
            violations=[
                "Unnecessary unsafe blocks",
                "Unsafe without safety comments",
                "Large unsafe blocks",
                "Unsafe in public APIs without documentation",
            ],
            detectable_patterns=["unsafe {", "unsafe fn"],
        ),
        ZenPrinciple(
            id="rust-009",
            principle="Use std traits appropriately",
            category=PrincipleCategory.IDIOMS,
            severity=7,
            description="Implement standard traits (Display, From, Into, etc.)",
            violations=[
                "Custom conversion instead of From/Into",
                "String formatting without Display",
                "Not implementing Default when appropriate",
                "Manual iteration instead of IntoIterator",
            ],
            detectable_patterns=["!impl From", "!impl Default"],
        ),
        ZenPrinciple(
            id="rust-010",
            principle="Prefer enums over booleans for state",
            category=PrincipleCategory.DESIGN,
            severity=7,
            description="Use enums to make state explicit",
            violations=[
                "Boolean flags for state",
                "Multiple related booleans",
                "State represented by Option<()>",
            ],
            detectable_patterns=["bool"],
        ),
        ZenPrinciple(
            id="rust-011",
            principle="Use lifetimes judiciously",
            category=PrincipleCategory.OWNERSHIP,
            severity=6,
            description="Let the compiler infer when possible, be explicit when needed",
            violations=[
                "Unnecessary lifetime annotations",
                "Overly complex lifetime bounds",
                "Fighting the borrow checker instead of redesigning",
            ],
            detectable_patterns=["<'a>", "<'static>"],
        ),
        ZenPrinciple(
            id="rust-012",
            principle="Avoid Rc<RefCell<T>> unless necessary",
            category=PrincipleCategory.DESIGN,
            severity=7,
            description="Prefer ownership or references over runtime borrowing",
            violations=[
                "Overuse of Rc<RefCell<T>>",
                "Interior mutability when not needed",
                "Arc<Mutex<T>> in single-threaded code",
            ],
            detectable_patterns=["Rc<RefCell", "Arc<Mutex"],
        ),
    ],
)
